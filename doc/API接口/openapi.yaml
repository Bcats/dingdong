openapi: 3.0.3
info:
  title: æ¶ˆæ¯é€šçŸ¥å¹³å° API
  description: |
    æ¶ˆæ¯é€šçŸ¥å¹³å°æä¾›ç»Ÿä¸€çš„æ¶ˆæ¯å‘é€æœåŠ¡ï¼Œæ”¯æŒå¤šç§æ¸ é“ï¼ˆé‚®ä»¶ã€çŸ­ä¿¡ã€å¾®ä¿¡ç­‰ï¼‰ã€‚
    
    ## ç‰¹æ€§
    - ğŸ“§ é‚®ä»¶å‘é€ï¼ˆæ”¯æŒHTMLã€é™„ä»¶ã€æ¨¡æ¿ï¼‰
    - ğŸ“± çŸ­ä¿¡å‘é€ï¼ˆç¬¬äºŒæœŸï¼‰
    - ğŸ’¬ å¾®ä¿¡æ¶ˆæ¯ï¼ˆç¬¬äºŒæœŸï¼‰
    - ğŸ“ æ¶ˆæ¯æ¨¡æ¿ç®¡ç†
    - ğŸ” JWT Tokenè®¤è¯
    - ğŸ“Š ç›‘æ§å’Œå¥åº·æ£€æŸ¥
    
    ## è®¤è¯æ–¹å¼
    1. ä½¿ç”¨API Keyå’ŒAPI Secretè·å–JWT Token
    2. åç»­è¯·æ±‚æºå¸¦Tokenï¼š`Authorization: Bearer {token}`
    
    ## é™æµç­–ç•¥
    - æ¯ä¸ªAPI Keyé»˜è®¤é™åˆ¶ï¼š1000æ¬¡/å°æ—¶
    - è¶…è¿‡é™åˆ¶è¿”å›429çŠ¶æ€ç 
    
    ## æŠ€æœ¯æ”¯æŒ
    - é‚®ç®±ï¼šsupport@example.com
    - æ–‡æ¡£ï¼šhttps://docs.example.com
    
  version: 1.0.0
  contact:
    name: æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ
    email: support@example.com
    url: https://docs.example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8000
    description: æœ¬åœ°å¼€å‘ç¯å¢ƒ
  - url: https://api-dev.example.com
    description: å¼€å‘ç¯å¢ƒ
  - url: https://api-staging.example.com
    description: æµ‹è¯•ç¯å¢ƒ
  - url: https://api.example.com
    description: ç”Ÿäº§ç¯å¢ƒ

tags:
  - name: è®¤è¯
    description: APIè®¤è¯ç›¸å…³æ¥å£
  - name: é‚®ä»¶
    description: é‚®ä»¶å‘é€ç›¸å…³æ¥å£
  - name: æ¨¡æ¿
    description: æ¶ˆæ¯æ¨¡æ¿ç®¡ç†æ¥å£
  - name: æ¶ˆæ¯
    description: æ¶ˆæ¯æŸ¥è¯¢ç›¸å…³æ¥å£
  - name: é™„ä»¶
    description: é™„ä»¶ç®¡ç†æ¥å£
  - name: å¥åº·æ£€æŸ¥
    description: ç³»ç»Ÿå¥åº·æ£€æŸ¥æ¥å£

paths:
  /health:
    get:
      tags:
        - å¥åº·æ£€æŸ¥
      summary: ç®€å•å¥åº·æ£€æŸ¥
      description: æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
      operationId: healthCheck
      responses:
        '200':
          description: æœåŠ¡æ­£å¸¸
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
  
  /health/ready:
    get:
      tags:
        - å¥åº·æ£€æŸ¥
      summary: å°±ç»ªæ£€æŸ¥
      description: æ£€æŸ¥æœåŠ¡åŠå…¶ä¾èµ–æ˜¯å¦å°±ç»ª
      operationId: healthReady
      responses:
        '200':
          description: æœåŠ¡å°±ç»ª
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheckResponse'
  
  /health/live:
    get:
      tags:
        - å¥åº·æ£€æŸ¥
      summary: å­˜æ´»æ£€æŸ¥
      description: æ£€æŸ¥æœåŠ¡è¿›ç¨‹æ˜¯å¦å­˜æ´»
      operationId: healthLive
      responses:
        '200':
          description: æœåŠ¡å­˜æ´»
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: alive
  
  /metrics:
    get:
      tags:
        - å¥åº·æ£€æŸ¥
      summary: Prometheusç›‘æ§æŒ‡æ ‡
      description: æš´éœ²Prometheusæ ¼å¼çš„ç›‘æ§æŒ‡æ ‡
      operationId: metricsExport
      responses:
        '200':
          description: ç›‘æ§æŒ‡æ ‡
          content:
            text/plain:
              schema:
                type: string
  
  /api/v1/auth/token:
    post:
      tags:
        - è®¤è¯
      summary: è·å–JWT Token
      description: ä½¿ç”¨API Keyå’ŒAPI Secretè·å–JWT Token
      operationId: getToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TokenRequest'
      responses:
        '200':
          description: Tokenè·å–æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
  
  /api/v1/auth/refresh:
    post:
      tags:
        - è®¤è¯
      summary: åˆ·æ–°JWT Token
      description: ä½¿ç”¨å½“å‰Tokenè·å–æ–°Token
      operationId: refreshToken
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Tokenåˆ·æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
  
  /api/v1/attachments/upload:
    post:
      tags:
        - é™„ä»¶
      summary: ä¸Šä¼ é™„ä»¶
      description: ä¸Šä¼ é‚®ä»¶é™„ä»¶ï¼Œè¿”å›attachment_id
      operationId: uploadAttachment
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: é™„ä»¶æ–‡ä»¶
                uploaded_by:
                  type: string
                  description: ä¸Šä¼ è€…
      responses:
        '200':
          description: ä¸Šä¼ æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttachmentUploadResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '413':
          description: æ–‡ä»¶è¿‡å¤§
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /api/v1/messages/email/send:
    post:
      tags:
        - é‚®ä»¶
      summary: å‘é€é‚®ä»¶
      description: |
        å‘é€é‚®ä»¶ï¼Œæ”¯æŒä¸¤ç§æ¨¡å¼ï¼š
        1. **ç›´æ¥å‘é€**ï¼šæä¾›subjectå’Œcontent
        2. **æ¨¡æ¿å‘é€**ï¼šæä¾›template_idå’Œtemplate_vars
        
        ä¸¤ç§æ¨¡å¼äºŒé€‰ä¸€ï¼Œä¸èƒ½åŒæ—¶æä¾›ã€‚
      operationId: sendEmail
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmailSendRequest'
            examples:
              direct:
                summary: ç›´æ¥å‘é€
                value:
                  to: "user@example.com"
                  subject: "æµ‹è¯•é‚®ä»¶"
                  content: "<h1>æµ‹è¯•å†…å®¹</h1>"
                  content_type: "html"
              template:
                summary: æ¨¡æ¿å‘é€
                value:
                  to: "user@example.com"
                  template_id: 1
                  template_vars:
                    username: "å¼ ä¸‰"
                    code: "123456"
                    expire_minutes: "5"
      responses:
        '200':
          description: é‚®ä»¶å‘é€æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageSendResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '503':
          description: æ— å¯ç”¨é‚®ç®±è´¦æˆ·
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /api/v1/messages/{message_id}:
    get:
      tags:
        - æ¶ˆæ¯
      summary: æŸ¥è¯¢æ¶ˆæ¯çŠ¶æ€
      description: æ ¹æ®message_idæŸ¥è¯¢æ¶ˆæ¯å‘é€çŠ¶æ€
      operationId: getMessage
      security:
        - bearerAuth: []
      parameters:
        - name: message_id
          in: path
          required: true
          description: æ¶ˆæ¯ID
          schema:
            type: string
            example: "msg_20251024_abc123"
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageDetailResponse'
        '404':
          $ref: '#/components/responses/NotFound'
  
  /api/v1/messages:
    get:
      tags:
        - æ¶ˆæ¯
      summary: æŸ¥è¯¢æ¶ˆæ¯åˆ—è¡¨
      description: åˆ†é¡µæŸ¥è¯¢æ¶ˆæ¯åˆ—è¡¨ï¼Œæ”¯æŒå¤šç§ç­›é€‰æ¡ä»¶
      operationId: listMessages
      security:
        - bearerAuth: []
      parameters:
        - name: recipient
          in: query
          description: æ¥æ”¶äºº
          schema:
            type: string
        - name: status
          in: query
          description: æ¶ˆæ¯çŠ¶æ€
          schema:
            type: string
            enum: [pending, sending, success, failed]
        - name: start_date
          in: query
          description: å¼€å§‹æ—¥æœŸ
          schema:
            type: string
            format: date
        - name: end_date
          in: query
          description: ç»“æŸæ—¥æœŸ
          schema:
            type: string
            format: date
        - name: page
          in: query
          description: é¡µç 
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: page_size
          in: query
          description: æ¯é¡µæ•°é‡
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageListResponse'
  
  /api/v1/messages/batch/query:
    post:
      tags:
        - æ¶ˆæ¯
      summary: æ‰¹é‡æŸ¥è¯¢æ¶ˆæ¯
      description: æ ¹æ®message_idåˆ—è¡¨æ‰¹é‡æŸ¥è¯¢æ¶ˆæ¯çŠ¶æ€
      operationId: batchGetMessages
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BatchQueryRequest'
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchQueryResponse'
  
  /api/v1/templates:
    get:
      tags:
        - æ¨¡æ¿
      summary: æŸ¥è¯¢æ¨¡æ¿åˆ—è¡¨
      description: åˆ†é¡µæŸ¥è¯¢æ¨¡æ¿åˆ—è¡¨
      operationId: listTemplates
      security:
        - bearerAuth: []
      parameters:
        - name: template_type
          in: query
          description: æ¨¡æ¿ç±»å‹
          schema:
            type: string
            enum: [email, sms, wechat]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateListResponse'
    
    post:
      tags:
        - æ¨¡æ¿
      summary: åˆ›å»ºæ¨¡æ¿
      description: åˆ›å»ºæ–°çš„æ¶ˆæ¯æ¨¡æ¿
      operationId: createTemplate
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TemplateCreateRequest'
      responses:
        '200':
          description: åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
  
  /api/v1/templates/{template_id}:
    get:
      tags:
        - æ¨¡æ¿
      summary: æŸ¥è¯¢æ¨¡æ¿è¯¦æƒ…
      description: æ ¹æ®æ¨¡æ¿IDæŸ¥è¯¢æ¨¡æ¿è¯¦ç»†ä¿¡æ¯
      operationId: getTemplate
      security:
        - bearerAuth: []
      parameters:
        - name: template_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateDetailResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    
    put:
      tags:
        - æ¨¡æ¿
      summary: æ›´æ–°æ¨¡æ¿
      description: æ›´æ–°æ¨¡æ¿å†…å®¹ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæ–°ç‰ˆæœ¬
      operationId: updateTemplate
      security:
        - bearerAuth: []
      parameters:
        - name: template_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TemplateUpdateRequest'
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    
    delete:
      tags:
        - æ¨¡æ¿
      summary: åˆ é™¤æ¨¡æ¿
      description: è½¯åˆ é™¤æ¨¡æ¿ï¼ˆè®¾ç½®deleted_atï¼‰
      operationId: deleteTemplate
      security:
        - bearerAuth: []
      parameters:
        - name: template_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: åˆ é™¤æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          $ref: '#/components/responses/NotFound'
  
  /api/v1/templates/{template_id}/history:
    get:
      tags:
        - æ¨¡æ¿
      summary: æŸ¥è¯¢æ¨¡æ¿å†å²ç‰ˆæœ¬
      description: æŸ¥è¯¢æ¨¡æ¿çš„æ‰€æœ‰å†å²ç‰ˆæœ¬
      operationId: getTemplateHistory
      security:
        - bearerAuth: []
      parameters:
        - name: template_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateHistoryResponse'
  
  /api/v1/templates/{template_id}/rollback:
    post:
      tags:
        - æ¨¡æ¿
      summary: å›æ»šæ¨¡æ¿
      description: å›æ»šåˆ°æŒ‡å®šå†å²ç‰ˆæœ¬
      operationId: rollbackTemplate
      security:
        - bearerAuth: []
      parameters:
        - name: template_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TemplateRollbackRequest'
      responses:
        '200':
          description: å›æ»šæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplateResponse'
  
  /api/v1/templates/preview:
    post:
      tags:
        - æ¨¡æ¿
      summary: é¢„è§ˆæ¨¡æ¿
      description: ä½¿ç”¨æµ‹è¯•æ•°æ®æ¸²æŸ“æ¨¡æ¿ï¼ŒæŸ¥çœ‹æœ€ç»ˆæ•ˆæœ
      operationId: previewTemplate
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TemplatePreviewRequest'
      responses:
        '200':
          description: é¢„è§ˆæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TemplatePreviewResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT Tokenè®¤è¯
  
  schemas:
    # ============ é€šç”¨å“åº” ============
    BaseResponse:
      type: object
      properties:
        code:
          type: integer
          description: çŠ¶æ€ç ï¼Œ0è¡¨ç¤ºæˆåŠŸ
          example: 0
        message:
          type: string
          description: å“åº”æ¶ˆæ¯
          example: "success"
        request_id:
          type: string
          description: è¯·æ±‚è¿½è¸ªID
          example: "req_xyz789"
        timestamp:
          type: string
          format: date-time
          description: å“åº”æ—¶é—´
    
    SuccessResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              nullable: true
    
    ErrorResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              nullable: true
    
    # ============ å¥åº·æ£€æŸ¥ ============
    HealthCheckResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                status:
                  type: string
                  enum: [healthy, unhealthy]
                components:
                  type: object
                  properties:
                    database:
                      type: string
                      enum: [ok, error]
                    redis:
                      type: string
                      enum: [ok, error]
                    rabbitmq:
                      type: string
                      enum: [ok, error]
    
    # ============ è®¤è¯ ============
    TokenRequest:
      type: object
      required:
        - api_key
        - api_secret
      properties:
        api_key:
          type: string
          description: APIå¯†é’¥
          example: "noti_abc123def456"
        api_secret:
          type: string
          description: APIå¯†é’¥
          format: password
          example: "your_api_secret"
    
    TokenResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                access_token:
                  type: string
                  description: JWT Token
                  example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                token_type:
                  type: string
                  description: Tokenç±»å‹
                  example: "bearer"
                expires_in:
                  type: integer
                  description: è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
                  example: 3600
    
    # ============ é™„ä»¶ ============
    AttachmentUploadResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                type: object
                properties:
                  attachment_id:
                    type: string
                    example: "att_20251024_abc123"
                  filename:
                    type: string
                    example: "report.pdf"
                  file_size:
                    type: integer
                    description: æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
                    example: 1024000
                  mime_type:
                    type: string
                    example: "application/pdf"
                  expires_at:
                    type: string
                    format: date-time
    
    # ============ é‚®ä»¶å‘é€ ============
    EmailSendRequest:
      type: object
      required:
        - to
      properties:
        to:
          type: string
          format: email
          description: æ”¶ä»¶äººé‚®ç®±
          example: "user@example.com"
        cc:
          type: array
          items:
            type: string
            format: email
          description: æŠ„é€åˆ—è¡¨
        bcc:
          type: array
          items:
            type: string
            format: email
          description: å¯†é€åˆ—è¡¨
        subject:
          type: string
          description: é‚®ä»¶ä¸»é¢˜ï¼ˆç›´æ¥å‘é€æ—¶å¿…å¡«ï¼‰
          example: "æµ‹è¯•é‚®ä»¶"
        content:
          type: string
          description: é‚®ä»¶å†…å®¹ï¼ˆç›´æ¥å‘é€æ—¶å¿…å¡«ï¼‰
          example: "<h1>æµ‹è¯•å†…å®¹</h1>"
        content_type:
          type: string
          enum: [html, text]
          default: html
          description: å†…å®¹ç±»å‹
        template_id:
          type: integer
          description: æ¨¡æ¿IDï¼ˆæ¨¡æ¿å‘é€æ—¶å¿…å¡«ï¼‰
          example: 1
        template_vars:
          type: object
          description: æ¨¡æ¿å˜é‡ï¼ˆæ¨¡æ¿å‘é€æ—¶å¿…å¡«ï¼‰
          additionalProperties: true
          example:
            username: "å¼ ä¸‰"
            code: "123456"
        attachment_ids:
          type: array
          items:
            type: string
          description: é™„ä»¶IDåˆ—è¡¨
          example: ["att_xxx", "att_yyy"]
        idempotency_key:
          type: string
          description: å¹‚ç­‰é”®ï¼Œé˜²æ­¢é‡å¤å‘é€
          example: "unique-key-123"
        async:
          type: boolean
          default: true
          description: æ˜¯å¦å¼‚æ­¥å‘é€
    
    MessageSendResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                message_id:
                  type: string
                  example: "msg_20251024_abc123"
                status:
                  type: string
                  enum: [pending, sending, success, failed]
                  example: "pending"
    
    # ============ æ¶ˆæ¯æŸ¥è¯¢ ============
    MessageDetailResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                message_id:
                  type: string
                message_type:
                  type: string
                  enum: [email, sms, wechat]
                recipient:
                  type: string
                subject:
                  type: string
                status:
                  type: string
                  enum: [pending, sending, success, failed]
                retry_count:
                  type: integer
                error_message:
                  type: string
                  nullable: true
                created_at:
                  type: string
                  format: date-time
                sent_at:
                  type: string
                  format: date-time
                  nullable: true
    
    MessageListResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                total:
                  type: integer
                  example: 100
                page:
                  type: integer
                  example: 1
                page_size:
                  type: integer
                  example: 20
                records:
                  type: array
                  items:
                    type: object
                    properties:
                      message_id:
                        type: string
                      recipient:
                        type: string
                      subject:
                        type: string
                      status:
                        type: string
                      created_at:
                        type: string
                        format: date-time
    
    BatchQueryRequest:
      type: object
      required:
        - message_ids
      properties:
        message_ids:
          type: array
          items:
            type: string
          maxItems: 100
          example: ["msg_20251024_abc123", "msg_20251024_abc124"]
    
    BatchQueryResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                type: object
                properties:
                  message_id:
                    type: string
                  status:
                    type: string
                  recipient:
                    type: string
                  sent_at:
                    type: string
                    format: date-time
                    nullable: true
    
    # ============ æ¨¡æ¿ç®¡ç† ============
    TemplateCreateRequest:
      type: object
      required:
        - template_name
        - template_type
        - content
      properties:
        template_name:
          type: string
          maxLength: 100
          example: "æ³¨å†ŒéªŒè¯ç "
        template_type:
          type: string
          enum: [email, sms, wechat]
          example: "email"
        subject:
          type: string
          maxLength: 255
          example: "æ‚¨çš„éªŒè¯ç "
        content:
          type: string
          example: "<p>æ‚¨çš„éªŒè¯ç æ˜¯ï¼š{{code}}</p>"
        variables:
          type: array
          items:
            type: string
          example: ["code", "username"]
        description:
          type: string
          example: "ç”¨æˆ·æ³¨å†ŒéªŒè¯ç æ¨¡æ¿"
        created_by:
          type: string
          example: "admin"
    
    TemplateUpdateRequest:
      type: object
      properties:
        subject:
          type: string
        content:
          type: string
        variables:
          type: array
          items:
            type: string
        change_description:
          type: string
          example: "ä¿®æ”¹é‚®ä»¶ä¸»é¢˜"
        updated_by:
          type: string
    
    TemplateResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                id:
                  type: integer
                template_name:
                  type: string
                template_type:
                  type: string
                subject:
                  type: string
                content:
                  type: string
                variables:
                  type: array
                  items:
                    type: string
                version:
                  type: integer
                is_active:
                  type: boolean
                description:
                  type: string
                created_at:
                  type: string
                  format: date-time
    
    TemplateDetailResponse:
      allOf:
        - $ref: '#/components/schemas/TemplateResponse'
    
    TemplateListResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                total:
                  type: integer
                page:
                  type: integer
                page_size:
                  type: integer
                records:
                  type: array
                  items:
                    type: object
    
    TemplateHistoryResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                type: object
                properties:
                  version:
                    type: integer
                  content:
                    type: string
                  created_by:
                    type: string
                  created_at:
                    type: string
                    format: date-time
    
    TemplateRollbackRequest:
      type: object
      required:
        - version
      properties:
        version:
          type: integer
          description: è¦å›æ»šåˆ°çš„ç‰ˆæœ¬å·
          example: 1
        change_description:
          type: string
          example: "å›æ»šåˆ°åˆå§‹ç‰ˆæœ¬"
        updated_by:
          type: string
          example: "admin"
    
    TemplatePreviewRequest:
      type: object
      required:
        - template_id
        - template_vars
      properties:
        template_id:
          type: integer
          example: 1
        template_vars:
          type: object
          additionalProperties: true
          example:
            username: "å¼ ä¸‰"
            code: "123456"
    
    TemplatePreviewResponse:
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                subject:
                  type: string
                  example: "æ‚¨çš„éªŒè¯ç "
                content:
                  type: string
                  example: "<p>æ‚¨çš„éªŒè¯ç æ˜¯ï¼š123456</p>"
  
  responses:
    BadRequest:
      description: è¯·æ±‚å‚æ•°é”™è¯¯
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 1001
            message: "è¯·æ±‚å‚æ•°é”™è¯¯"
            data: null
            request_id: "req_xyz789"
    
    Unauthorized:
      description: è®¤è¯å¤±è´¥
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 1002
            message: "è®¤è¯å¤±è´¥"
            data: null
            request_id: "req_xyz789"
    
    Forbidden:
      description: æƒé™ä¸è¶³
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 1003
            message: "æƒé™ä¸è¶³"
            data: null
            request_id: "req_xyz789"
    
    NotFound:
      description: èµ„æºä¸å­˜åœ¨
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 1004
            message: "èµ„æºä¸å­˜åœ¨"
            data: null
            request_id: "req_xyz789"

security:
  - bearerAuth: []

