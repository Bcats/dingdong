# é¡¹ç›®ç»“æ„è¯´æ˜

## ğŸ“ ç›®å½•ç»“æ„

```
notification-platform/
â”œâ”€â”€ app/                          # åº”ç”¨ä¸»ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                   # FastAPIåº”ç”¨å…¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                      # APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ dependencies.py       # APIä¾èµ–é¡¹ï¼ˆè®¤è¯ç­‰ï¼‰
â”‚   â”‚   â””â”€â”€ v1/                   # API v1ç‰ˆæœ¬
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ health.py         # å¥åº·æ£€æŸ¥
â”‚   â”‚       â”œâ”€â”€ auth.py           # è®¤è¯æ¥å£
â”‚   â”‚       â”œâ”€â”€ messages.py       # æ¶ˆæ¯æ¥å£
â”‚   â”‚       â””â”€â”€ templates.py      # æ¨¡æ¿æ¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py             # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ database.py           # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ logger.py             # æ—¥å¿—é…ç½®
â”‚   â”‚   â””â”€â”€ security.py           # å®‰å…¨åŠŸèƒ½ï¼ˆåŠ å¯†ã€JWTç­‰ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                   # æ•°æ®åº“æ¨¡å‹ï¼ˆSQLAlchemyï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py               # åŸºç¡€æ¨¡å‹ç±»
â”‚   â”‚   â”œâ”€â”€ message.py            # æ¶ˆæ¯è®°å½•æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ template.py           # æ¨¡æ¿æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ email.py              # é‚®ä»¶è´¦æˆ·/é™„ä»¶æ¨¡å‹
â”‚   â”‚   â””â”€â”€ api_key.py            # APIå¯†é’¥æ¨¡å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                  # Pydanticæ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ common.py             # é€šç”¨Schema
â”‚   â”‚   â”œâ”€â”€ auth.py               # è®¤è¯Schema
â”‚   â”‚   â”œâ”€â”€ message.py            # æ¶ˆæ¯Schema
â”‚   â”‚   â””â”€â”€ template.py           # æ¨¡æ¿Schema
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                 # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ email_service.py      # é‚®ä»¶å‘é€æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ template_service.py   # æ¨¡æ¿æœåŠ¡
â”‚   â”‚   â””â”€â”€ message_service.py    # æ¶ˆæ¯æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ tasks/                    # Celeryå¼‚æ­¥ä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ celery_app.py         # Celeryåº”ç”¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ email_tasks.py        # é‚®ä»¶å‘é€ä»»åŠ¡
â”‚   â”‚   â””â”€â”€ scheduled_tasks.py    # å®šæ—¶ä»»åŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ redis_client.py       # Rediså®¢æˆ·ç«¯å°è£…
â”‚   â”‚
â”‚   â””â”€â”€ tests/                    # æµ‹è¯•æ–‡ä»¶
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ conftest.py           # Pytesté…ç½®
â”‚       â”œâ”€â”€ test_health.py        # å¥åº·æ£€æŸ¥æµ‹è¯•
â”‚       â””â”€â”€ test_auth.py          # è®¤è¯æµ‹è¯•
â”‚
â”œâ”€â”€ docker/                       # Dockerç›¸å…³æ–‡ä»¶
â”‚   â””â”€â”€ Dockerfile                # ç”Ÿäº§ç¯å¢ƒDockerfile
â”‚
â”œâ”€â”€ scripts/                      # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ create_api_key.py         # åˆ›å»ºAPIå¯†é’¥
â”‚   â”œâ”€â”€ add_email_account.py      # æ·»åŠ é‚®ç®±è´¦æˆ·
â”‚   â””â”€â”€ init_db.py                # åˆå§‹åŒ–æ•°æ®åº“
â”‚
â”œâ”€â”€ alembic/                      # æ•°æ®åº“è¿ç§»
â”‚   â”œâ”€â”€ versions/                 # è¿ç§»ç‰ˆæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ env.py                    # Alembicç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ script.py.mako            # è¿ç§»æ¨¡æ¿
â”‚
â”œâ”€â”€ doc/                          # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ éœ€æ±‚æ–‡æ¡£/
â”‚   â”œâ”€â”€ å¼€å‘è§„èŒƒ/
â”‚   â”œâ”€â”€ æ•°æ®åº“è®¾è®¡/
â”‚   â”œâ”€â”€ APIæ¥å£/
â”‚   â””â”€â”€ éƒ¨ç½²è¿ç»´/
â”‚
â”œâ”€â”€ logs/                         # æ—¥å¿—ç›®å½•ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
â”œâ”€â”€ backups/                      # å¤‡ä»½ç›®å½•
â”‚
â”œâ”€â”€ .env                          # ç¯å¢ƒå˜é‡é…ç½®ï¼ˆéœ€åˆ›å»ºï¼‰
â”œâ”€â”€ .env.example                  # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore                    # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ .dockerignore                 # Dockerå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ .pre-commit-config.yaml       # Pre-commité…ç½®
â”‚
â”œâ”€â”€ alembic.ini                   # Alembicé…ç½®
â”œâ”€â”€ docker-compose.yml            # Docker Composeé…ç½®
â”œâ”€â”€ Dockerfile                    # Dockerfile
â”œâ”€â”€ pytest.ini                    # Pytesté…ç½®
â”œâ”€â”€ Makefile                      # Makeå‘½ä»¤
â”‚
â”œâ”€â”€ requirements.txt              # ç”Ÿäº§ä¾èµ–
â”œâ”€â”€ requirements-dev.txt          # å¼€å‘ä¾èµ–
â”‚
â”œâ”€â”€ README.md                     # é¡¹ç›®README
â”œâ”€â”€ QUICKSTART.md                 # å¿«é€Ÿå¼€å§‹æŒ‡å—
â””â”€â”€ PROJECT_STRUCTURE.md          # æœ¬æ–‡ä»¶
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          API Layer (FastAPI)            â”‚
â”‚  - è·¯ç”± (routers)                       â”‚
â”‚  - ä¾èµ–æ³¨å…¥ (dependencies)              â”‚
â”‚  - æ•°æ®éªŒè¯ (Pydantic schemas)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Service Layer (Business)         â”‚
â”‚  - ä¸šåŠ¡é€»è¾‘                             â”‚
â”‚  - æœåŠ¡ç¼–æ’                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Data Layer (Models & Database)     â”‚
â”‚  - SQLAlchemyæ¨¡å‹                       â”‚
â”‚  - æ•°æ®åº“æ“ä½œ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

1. **FastAPIåº”ç”¨** (`app/main.py`)
   - HTTPæœåŠ¡å™¨
   - è·¯ç”±ç®¡ç†
   - ä¸­é—´ä»¶
   - å¼‚å¸¸å¤„ç†

2. **Celery Worker** (`app/tasks/`)
   - å¼‚æ­¥ä»»åŠ¡å¤„ç†
   - é‚®ä»¶å‘é€
   - å®šæ—¶ä»»åŠ¡

3. **æ•°æ®åº“** (PostgreSQL)
   - æŒä¹…åŒ–å­˜å‚¨
   - äº‹åŠ¡ç®¡ç†

4. **ç¼“å­˜** (Redis)
   - æ¶ˆæ¯å»é‡
   - ä¼šè¯å­˜å‚¨

5. **æ¶ˆæ¯é˜Ÿåˆ—** (RabbitMQ)
   - ä»»åŠ¡é˜Ÿåˆ—
   - æ¶ˆæ¯ä¼ é€’

## ğŸ“ ä»£ç è§„èŒƒ

### å¯¼å…¥é¡ºåº
1. æ ‡å‡†åº“
2. ç¬¬ä¸‰æ–¹åº“
3. æœ¬åœ°æ¨¡å—

### å‘½åè§„èŒƒ
- ç±»åï¼šPascalCase (`EmailService`)
- å‡½æ•°/å˜é‡ï¼šsnake_case (`send_email`)
- å¸¸é‡ï¼šUPPER_CASE (`MAX_RETRY_COUNT`)
- ç§æœ‰æˆå‘˜ï¼š`_private_method`

### æ–‡æ¡£å­—ç¬¦ä¸²
```python
def function(arg1: str, arg2: int) -> bool:
    """
    å‡½æ•°ç®€è¿°
    
    Args:
        arg1: å‚æ•°1è¯´æ˜
        arg2: å‚æ•°2è¯´æ˜
        
    Returns:
        bool: è¿”å›å€¼è¯´æ˜
        
    Raises:
        ValueError: å¼‚å¸¸è¯´æ˜
    """
    pass
```

## ğŸ”„ æ•°æ®æµ

### é‚®ä»¶å‘é€æµç¨‹
```
APIè¯·æ±‚ â†’ è®¤è¯ â†’ æ•°æ®éªŒè¯ â†’ åˆ›å»ºæ¶ˆæ¯è®°å½• â†’ 
å‘é€åˆ°é˜Ÿåˆ— â†’ Celery Worker â†’ é‚®ç®±æ± é€‰æ‹© â†’ 
SMTPå‘é€ â†’ æ›´æ–°çŠ¶æ€ â†’ è¿”å›ç»“æœ
```

### æ¨¡æ¿æ¸²æŸ“æµç¨‹
```
APIè¯·æ±‚ â†’ è·å–æ¨¡æ¿ â†’ Jinja2æ¸²æŸ“ â†’ 
ç”Ÿæˆå†…å®¹ â†’ åˆ›å»ºæ¶ˆæ¯ â†’ å‘é€
```

## ğŸ› ï¸ å¼€å‘å·¥ä½œæµ

### æœ¬åœ°å¼€å‘
```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements-dev.txt

# 2. å¯åŠ¨ä¾èµ–æœåŠ¡
docker-compose up -d postgres redis rabbitmq

# 3. è¿è¡Œè¿ç§»
alembic upgrade head

# 4. å¯åŠ¨API
uvicorn app.main:app --reload

# 5. å¯åŠ¨Workerï¼ˆæ–°ç»ˆç«¯ï¼‰
celery -A app.tasks worker --loglevel=info

# 6. å¯åŠ¨Beatï¼ˆæ–°ç»ˆç«¯ï¼‰
celery -A app.tasks beat --loglevel=info
```

### æ·»åŠ æ–°åŠŸèƒ½
1. åˆ›å»ºæ•°æ®åº“æ¨¡å‹ (`models/`)
2. åˆ›å»ºPydantic Schema (`schemas/`)
3. å®ç°ä¸šåŠ¡é€»è¾‘ (`services/`)
4. åˆ›å»ºAPIè·¯ç”± (`api/v1/`)
5. ç¼–å†™æµ‹è¯• (`tests/`)
6. æ›´æ–°æ–‡æ¡£

### æ•°æ®åº“å˜æ›´
```bash
# 1. ä¿®æ”¹æ¨¡å‹
vim app/models/xxx.py

# 2. ç”Ÿæˆè¿ç§»
alembic revision --autogenerate -m "æè¿°"

# 3. åº”ç”¨è¿ç§»
alembic upgrade head

# 4. å›æ»šï¼ˆå¦‚éœ€è¦ï¼‰
alembic downgrade -1
```

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest app/tests/test_auth.py

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=app --cov-report=html
```

## ğŸ“Š ç›‘æ§

- **APIæ–‡æ¡£**: http://localhost:8000/docs
- **å¥åº·æ£€æŸ¥**: http://localhost:8000/health
- **PrometheusæŒ‡æ ‡**: http://localhost:8000/metrics
- **RabbitMQç®¡ç†**: http://localhost:15672
- **Flowerç›‘æ§**: http://localhost:5555

## ğŸ”’ å®‰å…¨

1. **ç¯å¢ƒå˜é‡**ï¼šæ•æ„Ÿä¿¡æ¯å­˜å‚¨åœ¨`.env`
2. **å¯†ç åŠ å¯†**ï¼šä½¿ç”¨bcryptå“ˆå¸Œ
3. **æ•°æ®åŠ å¯†**ï¼šä½¿ç”¨Fernetå¯¹ç§°åŠ å¯†
4. **JWTè®¤è¯**ï¼šåŸºäºAPI Key/Secret
5. **æ—¥å¿—è„±æ•**ï¼šæ•æ„Ÿå­—æ®µè‡ªåŠ¨è„±æ•

## ğŸ“¦ éƒ¨ç½²

è¯¦è§ [éƒ¨ç½²è¿ç»´æ‰‹å†Œ](./doc/éƒ¨ç½²è¿ç»´/éƒ¨ç½²è¿ç»´æ‰‹å†Œ-æ¶ˆæ¯é€šçŸ¥å¹³å°.md)

---

æ›´å¤šä¿¡æ¯è¯·å‚è€ƒé¡¹ç›®æ–‡æ¡£ç›®å½•ã€‚

